<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: cisco | Random Notes]]></title>
  <link href="http://devrandom.za.net/blog/categories/cisco/atom.xml" rel="self"/>
  <link href="http://devrandom.za.net/"/>
  <updated>2014-12-15T16:07:14+02:00</updated>
  <id>http://devrandom.za.net/</id>
  <author>
    <name><![CDATA[S.J. Louw]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[OSPF LSA's, Area Types, Network Types and Timers]]></title>
    <link href="http://devrandom.za.net/blog/2014/12/14/ospf-lsas-areas-networks-timers/"/>
    <updated>2014-12-14T22:41:32+02:00</updated>
    <id>http://devrandom.za.net/blog/2014/12/14/ospf-lsas-areas-networks-timers</id>
    <content type="html"><![CDATA[<p><img class="left" src="/images/blog_posts/ospf.png"></p>

<p>My shortish summarized version of the OSPF Link State Advertisements, Area Types, Network Types and Timers.</p>

<!--more-->


<br>


<br>


<br>


<h3>OSPF Link State Advertisements (LSA&rsquo;s):</h3>

<br>


<table>
<thead>
<tr>
<th align="center"> LSA </th>
<th align="left">      Name     </th>
<th align="left">                 Description                 </th>
<th align="left">                       Area                       </th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"> 1   </td>
<td align="left"> Router LSA    </td>
<td align="left">  Generated by Any router for any/all links  </td>
<td align="left">                    Intra-area                    </td>
</tr>
<tr>
<td align="center"> 2   </td>
<td align="left"> Network LSA   </td>
<td align="left">   Generated by a DR only for DR-used-links  </td>
<td align="left">                    Intra-area                    </td>
</tr>
<tr>
<td align="center"> 3   </td>
<td align="left"> Summary LSA   </td>
<td align="left">    Generated by ABRs to summarize 1 &amp; 2&rsquo;s   </td>
<td align="left">                    Inter-area                    </td>
</tr>
<tr>
<td align="center"> 4   </td>
<td align="left"> ASBR Summary  </td>
<td align="left"> Generated by ABRs to summarize NH of Type 5 </td>
<td align="left">                    Inter-area                    </td>
</tr>
<tr>
<td align="center"> 5   </td>
<td align="left"> External LSA  </td>
<td align="left">              Generated by ASBR              </td>
<td align="left">        Domain-wide (other than stub areas)       </td>
</tr>
<tr>
<td align="center"> 7   </td>
<td align="left"> NSSA External </td>
<td align="left">   Generated by ASBR specific to NSSA area   </td>
<td align="left"> NSSA only &ndash; Translated to Type 5 for other areas</td>
</tr>
</tbody>
</table>


<br>


<p><strong>1</strong> &ndash; Originated by all routers to tell the other routers in the area about their connected links.</p>

<p><strong>2</strong> &ndash; Originated by the DR in the area. Simplifies the graph of the area when there are multiple routers on the same segment.</p>

<p><strong>3</strong> &ndash; Originated by the ABR. Describes routes in other areas.</p>

<p><strong>4</strong> &ndash; Originated by the ABR. Describes inter-area reachability to a router that performed redistribution.</p>

<p><strong>5</strong> &ndash; Originated by the ASBR that performs the redistribution. Describes redistributed routes from another protocol.</p>

<p><strong>7</strong> &ndash; Originated by the ASBR, but ONLY applies to NSSA external areas. (Converted to type 5 LSA when the ABR of the NSSA originates them into area 0)</p>

<br>


<table>
<thead>
<tr>
<th align="center">LSA </th>
<th align="center">    Area    </th>
<th align="center"> RIB Indentifier </th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"> 1   </td>
<td align="center"> Intra-area </td>
<td align="center">        O        </td>
</tr>
<tr>
<td align="center"> 2   </td>
<td align="center"> Intra-area </td>
<td align="center">        O        </td>
</tr>
<tr>
<td align="center"> 3   </td>
<td align="center"> Inter-area </td>
<td align="center">       O IA      </td>
</tr>
<tr>
<td align="center"> 4   </td>
<td align="center"> Inter-area </td>
<td align="center">       O IA      </td>
</tr>
<tr>
<td align="center"> 5   </td>
<td align="center"> External   </td>
<td align="center">     E1 or E2    </td>
</tr>
<tr>
<td align="center"> 7   </td>
<td align="center"> External   </td>
<td align="center">     N1 or N2    </td>
</tr>
</tbody>
</table>


<h3>OSPF Area Types:</h3>

<ul>
<li><strong>stub</strong> = 1, 2, 3 + 0.0.0.0 default route</li>
<li><strong>total stub</strong> = 1, 2 + 0.0.0.0 default route</li>
<li><strong>NSSA</strong> = 1, 2, 3, 7  (0.0.0.0 default route is not automatically created although you can add it)</li>
<li><strong>total NSSA</strong> = 1, 2, 7 + 0.0.0.0 default route</li>
</ul>


<p>Anything that says <strong>&ldquo;total&rdquo;</strong> must get the <code>"no-summary"</code> on the CLI.</p>

<h3>OSPF Network Types:</h3>

<ul>
<li>Broadcast</li>
<li>Non-broadcast</li>
<li>Point-to-Point</li>
<li>Point-to-Multipoint</li>
<li>Point-to-Multipoint (Non-broadcast)</li>
</ul>


<p><strong>Mixing network types, combinations that will work:</strong></p>

<blockquote><p>Reason why some network types are not compatible with other is Network Types that use DR election will only be compatible with other types that also elects/requires DR election.</p></blockquote>

<ul>
<li>Broadcast to Broadcast</li>
<li>Non-Broadcast to Non-Broadcast</li>
<li>Point-to-Point to Point-to-Point</li>
<li>Point-to-Multipoint to Point-to-Multipoint</li>
<li>Broadcast to Non-Broadcast (MUST adjust hello/dead timers to form adjacency)</li>
<li>Point-to-Point to Point-to-Multipoint (MUST adjust hello/dead timers to form adjacency)</li>
</ul>


<p><strong>Point-to-(anything)</strong> does not use a DR.</p>

<p><strong>(anything)-to-Multipoint</strong> adds a /32 route advertisement. The DR and BDR is the only routers that is REQUIRED to peer with all other routers when <strong>&ldquo;Multipoint&rdquo;</strong> networks is used.</p>

<h3>OSPF Network Type Timers (Hello/Dead):</h3>

<p>Anything with <strong>&ldquo;multi&rdquo;</strong> or <strong>&ldquo;non&rdquo;</strong> uses slow timers <code>(30/120)</code>, others use fast timers <code>(10/40)</code>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cisco IOS and DNS views]]></title>
    <link href="http://devrandom.za.net/blog/2014/01/20/cisco-ios-and-dns-views/"/>
    <updated>2014-01-20T22:01:30+02:00</updated>
    <id>http://devrandom.za.net/blog/2014/01/20/cisco-ios-and-dns-views</id>
    <content type="html"><![CDATA[<p><img class="left" src="/images/blog_posts/cisco14.png"></p>

<p>Using DNS views on a Cisco router to query specific DNS servers for specified domains. In my case I&rsquo;m using it to direct all DNS queries to a service such as <a href="http://www.unotelly.com/unodns/">Unotelly</a> for accessing region locked web content (<a href="https://signup.netflix.com">Netflix</a>, <a href="http://www.hulu.com">Hulu</a> and <a href="http://www.pandora.com">Pandora</a> Internet Radio).</p>

<!--more-->


<br>


<br>


<h3>Variables used:</h3>

<ul>
<li><strong>UnoDNS Server 1:</strong> UnoDNS_server1</li>
<li><strong>UnoDNS Server 2:</strong> UnoDNS_server2</li>
<li><strong>Vlan1</strong> is the local subnet</li>
<li><strong>8.8.8.8</strong> and <strong>4.4.4.4</strong> is the default DNS servers</li>
</ul>


<h3>Create the alternate DNS view:</h3>

<p>These DNS servers will be used for the specified domains.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ip dns view GEOLOCKBYPASS
</span><span class='line'>dns forwarder UnoDNS_server1
</span><span class='line'>dns forwarder UnoDNS_server2
</span><span class='line'>dns forwarding source-interface Vlan1</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>Create the default DNS view:</h3>

<p>These DNS servers will be the default for all other queries.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ip dns view default
</span><span class='line'> domain timeout 2
</span><span class='line'> dns forwarder 8.8.8.8
</span><span class='line'> dns forwarder 4.4.4.4</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>Create a view-list and add the above created view:</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ip dns view-list DNS
</span><span class='line'> view GEOLOCKBYPASS 10
</span><span class='line'>  restrict name-group 1
</span><span class='line'> view default 1000</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>Specify what domains will use the alternate DNS view:</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ip dns name-list 1 permit .HULU.COM
</span><span class='line'>ip dns name-list 1 permit .PANDORA.COM
</span><span class='line'>ip dns name-list 1 permit .NETFLIX.COM
</span><span class='line'>ip dns server view-group DNS
</span><span class='line'>ip dns server</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ADSL setup and configuration on a Cisco 877 router]]></title>
    <link href="http://devrandom.za.net/blog/2014/01/20/adsl-setup-and-configuration-on-a-cisco-877-router/"/>
    <updated>2014-01-20T17:16:40+02:00</updated>
    <id>http://devrandom.za.net/blog/2014/01/20/adsl-setup-and-configuration-on-a-cisco-877-router</id>
    <content type="html"><![CDATA[<p><img class="left" src="/images/blog_posts/cisco13.png"></p>

<p>Setup and configuration guide to configure a Cisco 877 router for ADSL connection.</p>

<!--more-->


<br>


<br>


<br>


<br>


<h3>Variables used in configuration:</h3>

<ul>
<li><strong>DSL Username:</strong> ISP_DSL_USERNAME</li>
<li><strong>DSL Password:</strong> ISP_DSL_PASSWORD</li>
</ul>


<p><strong>Setup ATM interface:</strong>
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>interface ATM0
</span><span class='line'> no ip address
</span><span class='line'> no ip redirects
</span><span class='line'> no ip unreachables
</span><span class='line'> no ip proxy-arp
</span><span class='line'> ip flow ingress
</span><span class='line'> no atm ilmi-keepalive
</span><span class='line'> dsl bitswap both</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><strong>Setup the virtual ATM interface:</strong>
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>interface ATM0.1 point-to-point
</span><span class='line'> no ip redirects
</span><span class='line'> no ip unreachables
</span><span class='line'> no ip proxy-arp
</span><span class='line'> ip flow ingress
</span><span class='line'> pvc 8/35
</span><span class='line'>  pppoe-client dial-pool-number 1</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><strong>Setup the local inside interface. I will be using the default, Vlan1, interface:</strong>
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>interface Vlan1
</span><span class='line'> description FW_INSIDE
</span><span class='line'> ip address 172.16.1.1 255.255.255.0
</span><span class='line'> no ip redirects
</span><span class='line'> no ip unreachables
</span><span class='line'> no ip proxy-arp
</span><span class='line'> ip nat inside
</span><span class='line'> ip virtual-reassembly max-reassemblies 64
</span><span class='line'> ip tcp adjust-mss 1452
</span><span class='line'> no autostate</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><strong>Setup the DSL dialer interface:</strong>
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>interface Dialer0
</span><span class='line'> description FW_OUTSIDE
</span><span class='line'> ip address negotiated
</span><span class='line'> no ip redirects
</span><span class='line'> no ip unreachables
</span><span class='line'> no ip proxy-arp
</span><span class='line'> ip mtu 1492
</span><span class='line'> ip nat outside
</span><span class='line'> ip virtual-reassembly max-reassemblies 64
</span><span class='line'> encapsulation ppp
</span><span class='line'> ip tcp adjust-mss 1452
</span><span class='line'> dialer pool 1
</span><span class='line'> dialer idle-timeout 0
</span><span class='line'> dialer persistent delay 10
</span><span class='line'> dialer-group 1
</span><span class='line'> no cdp enable
</span><span class='line'> ppp authentication pap chap callin
</span><span class='line'> ppp chap hostname ISP_DSL_USERNAME
</span><span class='line'> ppp chap password ISP_DSL_PASSWORD
</span><span class='line'> ppp pap sent-username ISP_DSL_USERNAME password ISP_DSL_PASSWORD</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><strong>Create a default route for all traffic, outbound, to the Dialer0 interface:</strong>
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ip route 0.0.0.0 0.0.0.0 Dialer0</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><strong>Create an access-list to allow all traffic outbound from the inside subnet to outside any:</strong>
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>access-list 111 remark &lt;strong>&lt;strong>&lt;em>PERMIT local network Internet Access&lt;/em>&lt;/strong>&lt;/strong>
</span><span class='line'>access-list 111 permit ip 172.16.1.0 0.0.0.255 any
</span><span class='line'>access-list 111 permit ip any any</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><strong>Create a route-map for the inside to outside NAT and tell it to use access-list 111:</strong>
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>route-map NAT permit 10
</span><span class='line'> match ip address 111</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><strong>Create the inside to outside NAT rule and apply it on the outside interface:</strong>
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ip nat inside source route-map NAT interface Dialer0 overload</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>Display DSL connection statistics:</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>show dsl interface atm 0</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cisco IOS updating multiple no-ip dynamic DNS host names]]></title>
    <link href="http://devrandom.za.net/blog/2014/01/20/cisco-ios-updating-multiple-no-ip-dynamic-dns-host-names/"/>
    <updated>2014-01-20T00:27:31+02:00</updated>
    <id>http://devrandom.za.net/blog/2014/01/20/cisco-ios-updating-multiple-no-ip-dynamic-dns-host-names</id>
    <content type="html"><![CDATA[<p><img class="left" src="/images/blog_posts/noip.png"></p>

<p>Setting up a Cisco IOS router to update multiple <a href="http://www.noip.com">no-ip</a> dynamic DNS host names.</p>

<!--more-->


<br>


<br>


<br>


<br>


<br>


<h3>The following variables will be used:</h3>

<ul>
<li><strong>no-ip Username:</strong> noipusername</li>
<li><strong>no-ip Password:</strong> noippassword</li>
<li><strong>no-ip Hostname1:</strong> someddnshostname1.sytes.net</li>
<li><strong>no-ip Hostname1:</strong> someddnshostname2.sytes.net</li>
</ul>


<h3>First create the <a href="http://www.noip.com">no-ip</a> connection configuration.</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ip ddns update method no-ip
</span><span class='line'> HTTP
</span><span class='line'>  add &lt;a href="http://noipusername:noippassword@dynupdate.no-ip.com/nic/update?hostname=someddnshostname1.sytes.net,someddnshostname1.sytes.net&amp;myip=">http://noipusername:noippassword@dynupdate.no-ip.com/nic/update?hostname=someddnshostname1.sytes.net,someddnshostname1.sytes.net&amp;myip=&lt;/a>&lt;a>
</span><span class='line'>  remove &lt;a href="http://noipusername:noippassword@dynupdate.no-ip.com/nic/update?hostname=someddnshostname1.sytes.net,someddnshostname1.sytes.net&amp;myip=">http://noipusername:noippassword@dynupdate.no-ip.com/nic/update?hostname=someddnshostname1.sytes.net,someddnshostname1.sytes.net&amp;myip=&lt;/a>&lt;a>
</span><span class='line'> interval maximum 0 0 5 0</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>Then on the router&rsquo;s, internet facing, outside interface, apply the config.</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>interface Dialer0
</span><span class='line'> ip ddns update hostname someddnshostname1.sytes.net
</span><span class='line'> ip ddns update no-ip</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mac OS X Lion and Cisco IPSEC VPN pitfalls]]></title>
    <link href="http://devrandom.za.net/blog/2012/02/12/mac-os-x-lion-and-cisco-ipsec-vpn-pitfalls/"/>
    <updated>2012-02-12T00:00:00+02:00</updated>
    <id>http://devrandom.za.net/blog/2012/02/12/mac-os-x-lion-and-cisco-ipsec-vpn-pitfalls</id>
    <content type="html"><![CDATA[<p><img class="left" src="/images/blog_posts/cisco_vpn.png"></p>

<p>The Mac OS X Lion, Native VPN client, with Cisco IPSEC EasyVPN Server was NOT working properly for myself. The problem I faced was that traffic was NOT passed to the remote LAN when connected to VPN. Split-tunnel and normal EasyVPN setups did NOT work.</p>

<!--more-->


<br>


<br>


<ol>
<li><p><strong>When presented with a split-tunnel ACL the Apple client will create a proxy pair for each line.</strong></p>

<ul>
<li><p>i.e. VPN IP address of A with a split ACL of:</p>

<ul>
<li>permit B</li>
<li>permit C</li>
<li>permit D</li>
</ul>
</li>
</ul>


<p> You would see an ipsec sa from A to B, A to C, and A to D.</p></li>
<li><p><strong>When presented with a split-tunnel ACL the Cisco client will create a single ipsec sa:</strong></p>

<ul>
<li>i.e. A to any</li>
</ul>


<p>However the client will only route traffic to B, C, D over the tunnel.</p></li>
</ol>


<p>This is fine and has no problems when using a crypto map style setup for Cisco EasyVPN.</p>

<p>However when you configure the use of dVTI this becomes difficult.  This is because the VTI can only support 1 ipsec sa built to it.  As a results when the Apple client tries to propose the proxy pair for the A to C entry it is rejected.</p>

<p>This leaves you with two options here:</p>

<ol>
<li>Switch to a tunnel-all configuration</li>
<li>Switch back to the crypto map configuration rather than the virtual-template configuration.</li>
</ol>


<p><a href="https://supportforums.cisco.com/thread/2095921">Reference</a></p>

<h3>I chose to take the &ldquo;old&rdquo; crypto map style setup. Here&rsquo;s how I made it work on a Cisco 877 DSL router:</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ip nat inside source route-map NAT interface Dialer0 overload&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>route-map NAT permit 10
</span><span class='line'>match ip address 111
</span><span class='line'>exit&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>access-list 101  remark &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
</span><span class='line'>access-list 101  remark &lt;strong>&lt;strong>&lt;em>VPN Access-list&lt;/em>&lt;/strong>&lt;/strong>
</span><span class='line'>access-list 101  permit ip 172.16.20.0 0.0.0.255 172.16.40.0 0.0.0.15
</span><span class='line'>!
</span><span class='line'>access-list 111  remark &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
</span><span class='line'>access-list 111  remark &lt;strong>&lt;strong>&lt;em>DENY Local LAN to VPN Traffic&lt;/em>&lt;/strong>&lt;/strong>
</span><span class='line'>access-list 111  deny ip 172.16.20.0 0.0.0.255 172.16.40.0 0.0.0.15
</span><span class='line'>access-list 111  remark &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;
</span><span class='line'>access-list 111  remark &lt;strong>&lt;strong>&lt;em>PERMIT Networks Internet Access&lt;/em>&lt;/strong>&lt;/strong>
</span><span class='line'>access-list 111  permit ip 172.16.20.0 0.0.0.255 any
</span><span class='line'>access-list 111  permit ip any any&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>aaa new-model
</span><span class='line'>aaa authentication login userauth local
</span><span class='line'>aaa authorization network groupauth local&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>username myusername password 0 mypassword&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>crypto isakmp policy 3
</span><span class='line'>encryption 3des
</span><span class='line'>authentication pre-share
</span><span class='line'>group 2
</span><span class='line'>lifetime 86400
</span><span class='line'>exit&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>crypto isakmp client configuration group my_vpn
</span><span class='line'>key mysecretgroupkey
</span><span class='line'>dns 172.16.20.1 8.8.8.8
</span><span class='line'>domain my.domain
</span><span class='line'>pool my_vpn_pool
</span><span class='line'>acl 101
</span><span class='line'>max-logins 10
</span><span class='line'>max users 10
</span><span class='line'>save-password
</span><span class='line'>split-dns my.domain
</span><span class='line'>include-local-lan
</span><span class='line'>exit&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>crypto ipsec transform-set my_set esp-3des esp-md5-hmac
</span><span class='line'>exit&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>crypto dynamic-map dynmap 10
</span><span class='line'>set transform-set my_set
</span><span class='line'>set security-association idle-time 900
</span><span class='line'>reverse-route
</span><span class='line'>exit&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>crypto map clientmap client authentication list userauth
</span><span class='line'>crypto map clientmap isakmp authorization list groupauth
</span><span class='line'>crypto map clientmap client configuration address respond
</span><span class='line'>crypto map clientmap 10 ipsec-isakmp dynamic dynmap&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>ip local pool my_vpn_pool 172.16.40.2 172.16.40.8&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>interface Dialer0
</span><span class='line'>ip nat outside
</span><span class='line'>crypto map clientmap&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>interface vlan1
</span><span class='line'>no autostate
</span><span class='line'>ip nat inside</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>I have tested this setup with Mac OS X Lion VPN client and with iPhone IOS 5.0.1. All is working well now. Yeeaay!</p>
]]></content>
  </entry>
  
</feed>
