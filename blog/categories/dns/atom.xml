<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: dns | Random Notes]]></title>
  <link href="http://devrandom.za.net/blog/categories/dns/atom.xml" rel="self"/>
  <link href="http://devrandom.za.net/"/>
  <updated>2014-12-18T19:30:04+02:00</updated>
  <id>http://devrandom.za.net/</id>
  <author>
    <name><![CDATA[S.J. Louw]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Cisco IOS and DNS views]]></title>
    <link href="http://devrandom.za.net/blog/2014/01/20/cisco-ios-and-dns-views/"/>
    <updated>2014-01-20T22:01:30+02:00</updated>
    <id>http://devrandom.za.net/blog/2014/01/20/cisco-ios-and-dns-views</id>
    <content type="html"><![CDATA[<p><img class="left" src="/images/blog_posts/cisco14.png"></p>

<p>Using DNS views on a Cisco router to query specific DNS servers for specified domains. In my case I&rsquo;m using it to direct all DNS queries to a service such as <a href="http://www.unotelly.com/unodns/">Unotelly</a> for accessing region locked web content (<a href="https://signup.netflix.com">Netflix</a>, <a href="http://www.hulu.com">Hulu</a> and <a href="http://www.pandora.com">Pandora</a> Internet Radio).</p>

<!--more-->


<br>


<br>


<h3>Variables used:</h3>

<ul>
<li><strong>UnoDNS Server 1:</strong> UnoDNS_server1</li>
<li><strong>UnoDNS Server 2:</strong> UnoDNS_server2</li>
<li><strong>Vlan1</strong> is the local subnet</li>
<li><strong>8.8.8.8</strong> and <strong>4.4.4.4</strong> is the default DNS servers</li>
</ul>


<h3>Create the alternate DNS view:</h3>

<p>These DNS servers will be used for the specified domains.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ip dns view GEOLOCKBYPASS
</span><span class='line'>dns forwarder UnoDNS_server1
</span><span class='line'>dns forwarder UnoDNS_server2
</span><span class='line'>dns forwarding source-interface Vlan1</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>Create the default DNS view:</h3>

<p>These DNS servers will be the default for all other queries.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ip dns view default
</span><span class='line'> domain timeout 2
</span><span class='line'> dns forwarder 8.8.8.8
</span><span class='line'> dns forwarder 4.4.4.4</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>Create a view-list and add the above created view:</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ip dns view-list DNS
</span><span class='line'> view GEOLOCKBYPASS 10
</span><span class='line'>  restrict name-group 1
</span><span class='line'> view default 1000</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h3>Specify what domains will use the alternate DNS view:</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ip dns name-list 1 permit .HULU.COM
</span><span class='line'>ip dns name-list 1 permit .PANDORA.COM
</span><span class='line'>ip dns name-list 1 permit .NETFLIX.COM
</span><span class='line'>ip dns server view-group DNS
</span><span class='line'>ip dns server</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CentOS 5.7 - Build and install BIND DNS RPMS]]></title>
    <link href="http://devrandom.za.net/blog/2012/03/02/centos-5-dot-7-build-and-install-bind-9-dot-9-0-1-dns-rpms/"/>
    <updated>2012-03-02T00:00:00+02:00</updated>
    <id>http://devrandom.za.net/blog/2012/03/02/centos-5-dot-7-build-and-install-bind-9-dot-9-0-1-dns-rpms</id>
    <content type="html"><![CDATA[<p><img class="left" src="/images/blog_posts/dns.png"></p>

<p>This guide is just a quick howto compile and build the Linux DNS server, BIND, version 9.9.0-1 RPMS from the source RPM.</p>

<!--more-->


<br>


<br>


<br>


<h3>Building BIND 9.9.0-1 DNS server RPMS on CentOS 5.7:</h3>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>yum -y install make gcc rpm-build libtool autoconf openssl-devel libcap-devel libidn-devel libxml2-devel openldap-devel postgresql-devel sqlite-devel mysql-devel krb5-devel xmlto openscap-devel&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;cd /usr/src/redhat/SRPMS
</span><span class='line'>wget &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://centos.alt.ru/pub/repository/centos/5/SRPMS/bind-9.9.0-1.el5.src.rpm&quot;</span>&gt;http://centos.alt.ru/pub/repository/centos/5/SRPMS/bind-9.9.0-1.el5.src.rpm&lt;/a&gt;
</span><span class='line'>rpm -ivh &amp;mdash;nomd5 <span class="nb">bind</span>-9.9.0-1.el5.src.rpm&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;cd /usr/src/redhat/SPECS
</span><span class='line'>rpmbuild -ba ./bind9_9.spec&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;cd /usr/src/redhat/RPMS/x86_64/
</span><span class='line'>rpm -Uvh <span class="nb">bind</span>-9.9.0-1.x86_64.rpm <span class="nb">bind</span>-chroot-9.9.0-1.x86_64.rpm <span class="nb">bind</span>-utils-9.9.0-1.x86_64.rpm <span class="nb">bind</span>-libs-9.9.0-1.x86_64.rpm <span class="nb">bind</span>-devel-9.9.0-1.x86_64.rpm
</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fix for Mac OS X not resolving FQDN addresses over VPN]]></title>
    <link href="http://devrandom.za.net/blog/2012/02/18/fix-for-mac-os-x-not-resolving-fqdn-addresses-over-vpn/"/>
    <updated>2012-02-18T00:00:00+02:00</updated>
    <id>http://devrandom.za.net/blog/2012/02/18/fix-for-mac-os-x-not-resolving-fqdn-addresses-over-vpn</id>
    <content type="html"><![CDATA[<p><img class="left" src="/images/blog_posts/dns2.png"></p>

<p>On Mac OS X Lion (This also apply to all later versions of OSX), while connected to VPN, I was not able to resolve hostnames on a remote site. The solution was to create domain resolver files in <code>/etc/resolver</code> named for the different domains the I wanted resolved<!--more-->, for example:</p>

<br>


<br>


<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo mkdir /etc/resolver&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;vi /etc/resolver/yourdomain.com
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Add the following content and save the file:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nameserver x.x.x.x &lt;&ndash; the DNS server to resolve hosts for yourdomain.com
</span><span class='line'>domain yourdomain.com
</span><span class='line'>port 53</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>You can create as much as needed custom domain resolver files, one for each domain.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Cisco IOS DNS server]]></title>
    <link href="http://devrandom.za.net/blog/2010/04/30/cisco-ios-dns-server/"/>
    <updated>2010-04-30T00:00:00+02:00</updated>
    <id>http://devrandom.za.net/blog/2010/04/30/cisco-ios-dns-server</id>
    <content type="html"><![CDATA[<p><img class="left" src="/images/blog_posts/cisco3.png"></p>

<p>Setting up and running a full-fletched DNS server on Cisco IOS, most users will probably only need to do the following to enable the Cisco IOS DNS server for name lookups: For a more advanced DNS server configuration please read on&hellip;</p>

<!--more-->


<br>


<br>


<br>


<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Router01(config)#ip dns server
</span><span class='line'>Router01(config)#ip host Router02 192.168.1.2
</span><span class='line'>Router01(config)#ip host Router03 192.168.1.3
</span><span class='line'>Router01(config)#ip host Router04 192.168.1.4</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>And then on the client routers:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Router02(config)#ip name-server 192.168.1.1 (where 192.168.1.1 is the IP address of the router acting as DNS server)</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>For a more advanced DNS server configuration, I will create two primary domains, mywebsite1.com and mywebsite2.com. Under each I will add 3 ISP nameservers, 2 MX mail records and 1 host record to make the www work.</p>

<ul>
<li><strong>86400</strong> = 24 hours Refresh time</li>
<li><strong>3600</strong> = 1 hour Refresh retry time</li>
<li><strong>1209600</strong> = 14 days Authority expire time</li>
<li><strong>86400</strong> = 24 hours Minimum TTL for zone info</li>
</ul>


<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Router01(config)#ip dns server</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>For the www.mywebsite1.com domain:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Router01(config)#ip dns primary mywebsite1.com soa isp.ns1.mywebsite1.com &lt;a href="&#109;&#97;&#105;&#x6c;&#116;&#x6f;&#58;&#97;&#x64;&#109;&#105;&#x6e;&#x40;&#x6d;&#x79;&#119;&#x65;&#98;&#x73;&#x69;&#116;&#101;&#x31;&#46;&#99;&#x6f;&#109;">&#97;&#100;&#109;&#105;&#110;&#x40;&#109;&#121;&#x77;&#x65;&#98;&#115;&#105;&#x74;&#101;&#49;&#46;&#99;&#x6f;&#109;&lt;/a> 86400 3600 1209600 86400
</span><span class='line'>Router01(config)#ip host mywebsite1.com ns isp.ns1.mywebsite1.com
</span><span class='line'>Router01(config)#ip host mywebsite1.com ns isp.ns2.mywebsite1.com
</span><span class='line'>Router01(config)#ip host mywebsite1.com ns isp.ns3.mywebsite1.com
</span><span class='line'>Router01(config)#ip host mywebsite1.com mx 1 mail.mywebsite1.com
</span><span class='line'>Router01(config)#ip host mywebsite1.com mx 2 mail2.mywebsite1.com
</span><span class='line'>Router01(config)#ip host mail.mywebsite1.com 192.168.1.40
</span><span class='line'>Router01(config)#ip host mail2.mywebsite1.com 192.168.1.50
</span><span class='line'>Router01(config)#ip host www.mywebsite1.com 192.168.1.30</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>For the www.mywebsite2.com domain:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Router01(config)#ip dns primary mywebsite2.com soa isp.ns1.mywebsite2.com &lt;a href="&#x6d;&#x61;&#x69;&#108;&#x74;&#x6f;&#x3a;&#97;&#x64;&#109;&#105;&#x6e;&#x40;&#x6d;&#x79;&#x77;&#101;&#x62;&#x73;&#x69;&#116;&#101;&#x32;&#x2e;&#x63;&#111;&#x6d;">&#x61;&#100;&#109;&#x69;&#x6e;&#x40;&#109;&#x79;&#x77;&#101;&#98;&#x73;&#x69;&#116;&#x65;&#x32;&#x2e;&#99;&#111;&#x6d;&lt;/a> 86400 3600 1209600 86400
</span><span class='line'>Router01(config)#ip host mywebsite2.com ns isp.ns1.mywebsite2.com
</span><span class='line'>Router01(config)#ip host mywebsite2.com ns isp.ns2.mywebsite2.com
</span><span class='line'>Router01(config)#ip host mywebsite2.com ns isp.ns3.mywebsite2.com
</span><span class='line'>Router01(config)#ip host mywebsite2.com mx 1 mail.mywebsite2.com
</span><span class='line'>Router01(config)#ip host mywebsite2.com mx 2 mail2.mywebsite2.com
</span><span class='line'>Router01(config)#ip host mail.mywebsite2.com 192.168.1.70
</span><span class='line'>Router01(config)#ip host mail2.mywebsite2.com 192.168.1.80
</span><span class='line'>Router01(config)#ip host www.mywebsite2.com 192.168.1.60</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Verify the DNS setup:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Router01(config)#show hosts</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
</feed>
